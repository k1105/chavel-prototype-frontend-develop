# Chavel 仕様書

## 1. プロダクト概要

iPad向けのインタラクティブ電子書籍プロトタイプアプリケーション。従来の電子書籍リーダー機能に加え、AIを活用した書籍内キャラクターとの対話機能を実装。

### システム構成
- **フロントエンド**: Next.js + TypeScript + Tailwind CSS（シングルページアプリケーション）
- **APIサーバー**: 別プロジェクトで実装（AI対話処理）
- **通信方式**: Next.js API Router経由で外部APIと通信（非同期通信のみ）
- **動作環境**: iPad (iOS 15以上) / ローカルホスト実行
- **認証**: 不要（プロトタイプのため）

## 2. 機能仕様

### 2.1 電子書籍リーダー機能

#### 基本機能
- **ページめくり**: スワイプジェスチャー、タップでのページ送り
- **ズーム**: ピンチイン/アウトでの拡大縮小
- **ブックマーク**: 任意のページを保存
- **検索**: 全文検索機能
- **目次**: チャプター単位でのジャンプ
- **読書進捗**: パーセンテージ表示、読了予測時間

#### 表示設定
- **フォントサイズ**: 5段階調整
- **背景色**: ライト/ダーク/セピア
- **行間**: 3段階調整
- **余白**: カスタマイズ可能
- **縦書き/横書き**: 切り替え対応

### 2.2 AIキャラクター対話機能

#### キャラクター認識
- **自動検出**: テキスト内のキャラクター名を自動識別
- **プロファイル生成**: キャラクターの性格・背景を分析
- **関係性マッピング**: キャラクター間の関係を把握

#### 対話インターフェース
- **チャットUI**: LINEライクな会話画面
- **音声入力**: 音声認識での入力対応
- **感情表現**: キャラクターの感情状態を視覚化
- **コンテキスト保持**: 会話履歴を考慮した応答

#### 対話モード
1. **フリートーク**: 自由な会話
2. **質問モード**: 物語に関する質問
3. **ロールプレイ**: シチュエーション別会話
4. **相談モード**: キャラクターに相談

### 2.3 コンテンツ管理

#### ライブラリ
- **書籍一覧**: グリッド/リスト表示
- **カテゴリ分類**: ジャンル、作者、タグ
- **読書履歴**: 最近読んだ書籍
- **お気に入り**: スター機能

#### データ保存
- **ローカルストレージ**: ブラウザ内でのデータ保存
- **セッションストレージ**: 一時的なデータ保存
- **IndexedDB**: 大容量データの保存（書籍データ等）

## 3. 画面仕様

### 3.1 シングルページ構成
アプリケーション全体を1つのページで実装し、以下の2つのビューを切り替えて表示：

1. **書籍一覧ビュー**:
   - 書籍のグリッド表示
   - 書籍選択機能

2. **リーダー/チャットビュー**:
   - 左側: 電子書籍リーダー
   - 右側: チャットパネル（キャラクター対話）
   - レスポンシブレイアウト対応

### 3.2 画面遷移
```
書籍一覧ビュー
    ↓ （書籍選択）
リーダー/チャットビュー
    ↓ （戻るボタン）
書籍一覧ビュー
```

### 3.3 UI要素

#### ナビゲーション
- **タブバー**: 下部固定（ホーム、探索、ライブラリ、設定）
- **ヘッダー**: コンテキストに応じた操作ボタン
- **フローティングボタン**: AIチャット起動

#### インタラクション
- **長押し**: コンテキストメニュー表示
- **スワイプ**: ページ送り、削除アクション
- **ピンチ**: ズーム操作
- **ダブルタップ**: 自動ズーム

## 4. データ仕様

### 4.1 書籍データ
```typescript
interface Book {
  id: string;
  title: string;
  author: string;
  cover: string;
  content: Chapter[];
  characters: Character[];
  metadata: {
    isbn?: string;
    publisher?: string;
    publishedDate?: Date;
    genre: string[];
    tags: string[];
  };
}
```

### 4.2 キャラクターデータ
```typescript
interface Character {
  id: string;
  name: string;
  profile: {
    age?: number;
    gender?: string;
    personality: string[];
    background: string;
    relationships: Relationship[];
  };
  appearance: {
    description: string;
    imageUrl?: string;
  };
  dialogueStyle: {
    tone: string;
    vocabulary: string[];
    catchphrases: string[];
  };
}
```

### 4.3 会話データ
```typescript
interface Conversation {
  id: string;
  sessionId: string;  // ブラウザセッション識別子
  characterId: string;
  bookId: string;
  messages: Message[];
  context: {
    chapter?: number;
    scene?: string;
    mood?: string;
  };
  createdAt: Date;
  updatedAt: Date;
}
```

## 5. 非機能要件

### 5.1 パフォーマンス
- **起動時間**: 3秒以内
- **ページ遷移**: 0.5秒以内
- **AI応答**: 2秒以内（ストリーミング対応）
- **フレームレート**: 60fps維持

### 5.2 セキュリティ
- **通信**: HTTPSは不要（ローカルホスト実行）
- **データ保護**: ローカルストレージ内のみ
- **XSS対策**: サニタイゼーション実装

### 5.3 可用性
- **ローカル実行**: プロトタイプ展示での安定動作
- **エラーハンドリング**: APIサーバー接続エラー時の適切な表示
- **フォールバック**: AI機能が利用できない場合の対応

### 5.4 拡張性
- **コンテンツ形式**: EPUB3, PDF対応
- **言語**: 日本語、英語（将来的に多言語対応）
- **AI モデル**: プラガブルアーキテクチャ

## 6. 制約事項

### 6.1 技術的制約
- iOS 15以上のiPadのみ対応
- インターネット接続必須（AI機能利用時）
- ストレージ容量: 最低2GB必要

### 6.2 コンテンツ制約
- DRM保護されたコンテンツは非対応
- 最大ファイルサイズ: 500MB/冊
- 対応フォーマット: EPUB, PDF, TXT

### 6.3 AI制約
- APIサーバーが起動している必要あり
- レスポンス時間はAPIサーバーの性能に依存
- コンテキスト長: APIサーバー側の設定に依存